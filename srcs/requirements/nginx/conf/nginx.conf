# Global settings for Nginx
user www-data;  # User that runs the Nginx worker processes
worker_processes auto;  # Automatically determine the number of worker processes based on available CPU cores
pid /run/nginx.pid;  # File that stores the process ID of the Nginx server

# Events configuration
events {
    worker_connections 1024;  # Maximum number of simultaneous connections per worker process
}

# HTTP server configuration
http {

    server {
        # Listen on port 443 with SSL enabled
        listen 443 ssl;
        listen [::]:443 ssl;  # For IPv6 support

        # SSL protocols and certificate paths
        ssl_protocols TLSv1.2 TLSv1.3;  # Enable only secure versions of TLS
        ssl_certificate /etc/nginx/ssl/inception.crt;  # Path to the SSL certificate
        ssl_certificate_key /etc/nginx/ssl/inception.key;  # Path to the SSL certificate key

        # Domain name and root directory
        server_name momrane.42.fr;  # Set the server name based on an environment variable
        root /var/www/html/wordpress;  # Root directory for serving files
        index index.php index.html index.htm;  # Default index files, fixed typo in index file list

        # Main location block for serving requests
        location / {
            try_files $uri $uri/ =404;  # Try to serve the requested URI or return a 404 error if not found
        }

        # Location block for PHP files
        location ~ \.php$ {
            include snippets/fastcgi-php.conf;  # Include FastCGI configuration for PHP
            fastcgi_pass wordpress:9000;  # Pass PHP requests to the FastCGI server (containerized PHP service)
            include /etc/nginx/fastcgi_params;  # Include standard FastCGI parameters
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;  # Set the script filename for PHP processing
        }
    }
}
